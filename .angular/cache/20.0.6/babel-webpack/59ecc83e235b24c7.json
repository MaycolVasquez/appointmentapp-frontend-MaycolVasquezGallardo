{"ast":null,"code":"import { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { finalize } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../_service/product.service\";\nimport * as i2 from \"../_service/category.service\";\nimport * as i3 from \"../_service/family.service\";\nimport * as i4 from \"../_service/laboratory.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nfunction ProductFormComponent_option_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", c_r2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(c_r2.name);\n  }\n}\nfunction ProductFormComponent_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementStart(2, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function ProductFormComponent_div_13_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.loadCatalogs());\n    });\n    i0.ɵɵtext(3, \"Reintentar\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"\", ctx_r3.categoriesError, \" \");\n  }\n}\nfunction ProductFormComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Cargando categor\\u00EDas...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductFormComponent_option_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const f_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", f_r5);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(f_r5.name);\n  }\n}\nfunction ProductFormComponent_div_21_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementStart(2, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function ProductFormComponent_div_21_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.loadCatalogs());\n    });\n    i0.ɵɵtext(3, \"Reintentar\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"\", ctx_r3.familiesError, \" \");\n  }\n}\nfunction ProductFormComponent_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Cargando familias...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ProductFormComponent_option_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 4);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const l_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", l_r7);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(l_r7.name);\n  }\n}\nfunction ProductFormComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementStart(2, \"button\", 11);\n    i0.ɵɵlistener(\"click\", function ProductFormComponent_div_29_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.loadCatalogs());\n    });\n    i0.ɵɵtext(3, \"Reintentar\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"\", ctx_r3.laboratoriesError, \" \");\n  }\n}\nfunction ProductFormComponent_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Cargando laboratorios...\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let ProductFormComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class ProductFormComponent {\n    constructor(productService, categoryService, familyService, laboratoryService, route, router) {\n      this.productService = productService;\n      this.categoryService = categoryService;\n      this.familyService = familyService;\n      this.laboratoryService = laboratoryService;\n      this.route = route;\n      this.router = router;\n      this.product = {\n        name: '',\n        expired: false\n      };\n      this.isEditMode = false;\n      this.categories = [];\n      this.families = [];\n      this.laboratories = [];\n      // Flags de carga y error para catálogos\n      this.loadingCategories = false;\n      this.loadingFamilies = false;\n      this.loadingLaboratories = false;\n      this.categoriesError = null;\n      this.familiesError = null;\n      this.laboratoriesError = null;\n      this.apiBase = environment.apiUrl;\n      // Comparadores para selects\n      this.compareCategory = (a, b) => a && b ? a.idCategory === b.idCategory : a === b;\n      this.compareFamily = (a, b) => a && b ? a.idFamily === b.idFamily : a === b;\n      this.compareLaboratory = (a, b) => a && b ? a.idLaboratory === b.idLaboratory : a === b;\n    }\n    ngOnInit() {\n      // Cargar catálogos\n      this.loadCatalogs();\n      this.route.params.subscribe(params => {\n        if (params['id']) {\n          this.isEditMode = true;\n          this.productId = +params['id'];\n          this.loadProduct(this.productId);\n        }\n      });\n    }\n    loadCatalogs() {\n      // Categorías\n      this.loadingCategories = true;\n      this.categoriesError = null;\n      this.categoryService.list().pipe(finalize(() => this.loadingCategories = false)).subscribe({\n        next: data => this.categories = data || [],\n        error: err => {\n          console.error('Error cargando categorías:', err);\n          this.categoriesError = `No se pudieron cargar categorías desde ${this.apiBase}/categories`;\n        }\n      });\n      // Familias\n      this.loadingFamilies = true;\n      this.familiesError = null;\n      this.familyService.list().pipe(finalize(() => this.loadingFamilies = false)).subscribe({\n        next: data => this.families = data || [],\n        error: err => {\n          console.error('Error cargando familias:', err);\n          this.familiesError = `No se pudieron cargar familias desde ${this.apiBase}/families`;\n        }\n      });\n      // Laboratorios\n      this.loadingLaboratories = true;\n      this.laboratoriesError = null;\n      this.laboratoryService.list().pipe(finalize(() => this.loadingLaboratories = false)).subscribe({\n        next: data => this.laboratories = data || [],\n        error: err => {\n          console.error('Error cargando laboratorios:', err);\n          this.laboratoriesError = `No se pudieron cargar laboratorios desde ${this.apiBase}/laboratories`;\n        }\n      });\n    }\n    loadProduct(id) {\n      this.productService.getById(id).subscribe({\n        next: data => {\n          this.product = data;\n        },\n        error: err => {\n          console.error('Error al cargar producto:', err);\n          alert('Error al cargar el producto');\n          this.router.navigate(['/product']);\n        }\n      });\n    }\n    save() {\n      // Preparar payload enviando solo IDs de catálogos si existen\n      const payload = {\n        idProduct: this.isEditMode ? this.productId : undefined,\n        name: this.product.name,\n        expired: this.product.expired,\n        category: this.product.category ? {\n          idCategory: this.product.category.idCategory\n        } : null,\n        family: this.product.family ? {\n          idFamily: this.product.family.idFamily\n        } : null,\n        laboratory: this.product.laboratory ? {\n          idLaboratory: this.product.laboratory.idLaboratory\n        } : null\n      };\n      if (this.isEditMode && this.productId) {\n        payload.idProduct = this.productId;\n        this.productService.update(payload).subscribe({\n          next: () => {\n            alert('Producto actualizado exitosamente');\n            this.router.navigate(['/product']);\n          },\n          error: err => {\n            console.error('Error:', err);\n            alert('Error al actualizar el producto');\n          }\n        });\n      } else {\n        this.productService.save(payload).subscribe({\n          next: () => {\n            alert('Producto guardado exitosamente');\n            this.router.navigate(['/product']);\n          },\n          error: err => {\n            console.error('Error:', err);\n            alert('Error al guardar el producto');\n          }\n        });\n      }\n    }\n    cancel() {\n      this.router.navigate(['/product']);\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function ProductFormComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || ProductFormComponent)(i0.ɵɵdirectiveInject(i1.ProductService), i0.ɵɵdirectiveInject(i2.CategoryService), i0.ɵɵdirectiveInject(i3.FamilyService), i0.ɵɵdirectiveInject(i4.LaboratoryService), i0.ɵɵdirectiveInject(i5.ActivatedRoute), i0.ɵɵdirectiveInject(i5.Router));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ProductFormComponent,\n      selectors: [[\"app-product-form\"]],\n      decls: 35,\n      vars: 22,\n      consts: [[\"f\", \"ngForm\"], [3, \"ngSubmit\"], [\"name\", \"name\", \"required\", \"\", 3, \"ngModelChange\", \"ngModel\"], [\"name\", \"category\", \"required\", \"\", 3, \"ngModelChange\", \"ngModel\", \"compareWith\"], [3, \"ngValue\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"error\", 4, \"ngIf\"], [4, \"ngIf\"], [\"name\", \"family\", \"required\", \"\", 3, \"ngModelChange\", \"ngModel\", \"compareWith\"], [\"name\", \"laboratory\", \"required\", \"\", 3, \"ngModelChange\", \"ngModel\", \"compareWith\"], [\"type\", \"submit\", 3, \"disabled\"], [\"type\", \"button\", 3, \"click\"], [1, \"error\"]],\n      template: function ProductFormComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"h2\");\n          i0.ɵɵtext(1);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(2, \"form\", 1, 0);\n          i0.ɵɵlistener(\"ngSubmit\", function ProductFormComponent_Template_form_ngSubmit_2_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.save());\n          });\n          i0.ɵɵelementStart(4, \"label\");\n          i0.ɵɵtext(5, \"Nombre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(6, \"input\", 2);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function ProductFormComponent_Template_input_ngModelChange_6_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.name, $event) || (ctx.product.name = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(7, \"label\");\n          i0.ɵɵtext(8, \"Categor\\u00EDa\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"select\", 3);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function ProductFormComponent_Template_select_ngModelChange_9_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.category, $event) || (ctx.product.category = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementStart(10, \"option\", 4);\n          i0.ɵɵtext(11, \"-- Seleccione --\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(12, ProductFormComponent_option_12_Template, 2, 2, \"option\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(13, ProductFormComponent_div_13_Template, 4, 1, \"div\", 6)(14, ProductFormComponent_div_14_Template, 2, 0, \"div\", 7);\n          i0.ɵɵelementStart(15, \"label\");\n          i0.ɵɵtext(16, \"Familia\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(17, \"select\", 8);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function ProductFormComponent_Template_select_ngModelChange_17_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.family, $event) || (ctx.product.family = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementStart(18, \"option\", 4);\n          i0.ɵɵtext(19, \"-- Seleccione --\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(20, ProductFormComponent_option_20_Template, 2, 2, \"option\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(21, ProductFormComponent_div_21_Template, 4, 1, \"div\", 6)(22, ProductFormComponent_div_22_Template, 2, 0, \"div\", 7);\n          i0.ɵɵelementStart(23, \"label\");\n          i0.ɵɵtext(24, \"Laboratorio\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"select\", 9);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function ProductFormComponent_Template_select_ngModelChange_25_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.laboratory, $event) || (ctx.product.laboratory = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementStart(26, \"option\", 4);\n          i0.ɵɵtext(27, \"-- Seleccione --\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(28, ProductFormComponent_option_28_Template, 2, 2, \"option\", 5);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(29, ProductFormComponent_div_29_Template, 4, 1, \"div\", 6)(30, ProductFormComponent_div_30_Template, 2, 0, \"div\", 7);\n          i0.ɵɵelementStart(31, \"button\", 10);\n          i0.ɵɵtext(32);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(33, \"button\", 11);\n          i0.ɵɵlistener(\"click\", function ProductFormComponent_Template_button_click_33_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.cancel());\n          });\n          i0.ɵɵtext(34, \"Cancelar\");\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          const f_r9 = i0.ɵɵreference(3);\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate(ctx.isEditMode ? \"Editar Producto\" : \"Nuevo Producto\");\n          i0.ɵɵadvance(5);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.name);\n          i0.ɵɵadvance(3);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.category);\n          i0.ɵɵproperty(\"compareWith\", ctx.compareCategory);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngValue\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.categoriesError);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.loadingCategories);\n          i0.ɵɵadvance(3);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.family);\n          i0.ɵɵproperty(\"compareWith\", ctx.compareFamily);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngValue\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.families);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.familiesError);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.loadingFamilies);\n          i0.ɵɵadvance(3);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.laboratory);\n          i0.ɵɵproperty(\"compareWith\", ctx.compareLaboratory);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngValue\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.laboratories);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.laboratoriesError);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.loadingLaboratories);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"disabled\", !f_r9.valid);\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate(ctx.isEditMode ? \"Actualizar\" : \"Guardar\");\n        }\n      },\n      dependencies: [CommonModule, i6.NgForOf, i6.NgIf, FormsModule, i7.ɵNgNoValidate, i7.NgSelectOption, i7.ɵNgSelectMultipleOption, i7.DefaultValueAccessor, i7.SelectControlValueAccessor, i7.NgControlStatus, i7.NgControlStatusGroup, i7.RequiredValidator, i7.NgModel, i7.NgForm],\n      encapsulation: 2\n    }));\n  }\n  _staticBlock();\n  return ProductFormComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}